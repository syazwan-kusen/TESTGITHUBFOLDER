@using Newtonsoft.Json;
@using myvdbsSQL;
@using MyVDBSDemo.Models;
@*@model IEnumerable<MyVDBSDemo.Models.Verify>*@
@model MyVDBSDemo.Models.VulneralibilityProjectData
@using MVCEncrypt;


@{
    ViewBag.Title = "Vulnerability Project List";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "__AjaxAntiForgeryForm" }))
{
    @Html.AntiForgeryToken()
}
<script>
    $(function () {
        $("#tabs").tabs();
    });
</script>

<body>
    @*<div class="col-lg-12">
            <div class="panel-default" style="text-align:center;background-color:#7BE4E4;text-transform:uppercase;text-decoration:solid"><h3>Audit Trail</h3></div>
        </div>*@

    <div class="col-lg-12" style="margin-top:70px;">
        <div class="panel panel-info">
            <div class="panel-heading">
                <h3 class="panel-title">Vulnerability Project List Add</h3>
            </div>
            <div id="tabs">
                <ul>
                    <li><a href="#tabs-1">Client Information</a></li>
                    <li><a href="#tabs-2">Scope of Work</a></li>
                </ul>
                <div id="tabs-1">
                    @Html.Partial("ClientInformation")
                </div>

                <div id="tabs-2">
                    @*@Html.Partial("ScopeOfWork")*@
                </div>
            </div>
        </div>
    </div>

    @*@Html.Partial("_CommonDialog")*@
</body>


<script src="~/Scripts/Common/Common.js"></script>
<script>

    var Register = @Html.Raw(JsonConvert.SerializeObject(@Model, Formatting.None,
                new JsonSerializerSettings()
                {

                    ReferenceLoopHandling = ReferenceLoopHandling.Ignore
                }));

    var formCsrf = $('#__AjaxAntiForgeryForm');
    var tokenCsrf = $('input[name="__RequestVerificationToken"]', formCsrf).val();
</script>

<script>
    $("#tabs").tabs({ active: 0 });
    $("#tabs").tabs("option", "disabled", [1])
    $("#verifyUser").dataTable({ pageLength: 5, "bLengthChange": false, });
    $("#verifyUser2").dataTable({ pageLength: 5, "bLengthChange": false, });
    $("#verifyUser3").dataTable({ pageLength: 5, "bLengthChange": false, });
    $("#verifyUser4").dataTable({ pageLength: 5, "bLengthChange": false, });
    $("#verifyUser5").dataTable({ pageLength: 5, "bLengthChange": false, });
    $("#verifyUser6").dataTable({ pageLength: 5, "bLengthChange": false, });

    $(function () {

        viewModel = {
            Vulnerability: ko.mapping.fromJS(Register),
            city: ko.observableArray([]),
            cityCd: ko.observable(""),
            state: ko.observableArray([]),
            stateCd: ko.observable(""),


            save: function () {
                var value = $("#myForm").validationEngine('validate');

                viewModel.Vulnerability.VulProj.VulProjectName(htmlEnc($("#project_nm").val()));
                //if (viewModel.Agency.ParentAgcyind() == null) {
                //    viewModel.Agency.ParentAgcyind(true);
                //}

                if (value == true) {
                    ShowDecisionMessage("Are you sure to save this Record ? ", function () {
                        $.ajax({
                            type: 'POST',
                            url: server + '/Admin/AddVulClient',
                            contentType: "application/json; charset=utf-8",
                            headers: {
                                '__RequestVerificationToken': tokenCsrf
                            },
                            data: JSON.stringify({ modelss: ko.mapping.toJS(viewModel.Vulnerability.VulProj), modelss2: ko.mapping.toJS(viewModel.Vulnerability.VulProj.a) }),
                            success: function (msg) {
                                if (msg.OK) {
                                    ShowMessageSuccess("Data successfully add.");
                                    //$(window).click(function() {
                                    // $("#tabs").tabs({ active: 1 });

                                    location.href = msg.url;

                                    //});

                                }
                                else {
                                    ShowMessage('Unsuccesfully add.');
                                }

                            },
                            error: function (xhr) {
                            }
                        });
                    });
                } else {
                    $("#myForm").validationEngine();
                }

            },

        }

        if (viewModel.Vulnerability.VulProj.a.StateCd() != null) {
            loadCity(viewModel.Vulnerability.VulProj.a.StateCd());
        }

        viewModel.Vulnerability.VulProj.a.StateCd.subscribe(function (d) {

            if (d) {
                loadCity(d);
            }
        });

        ko.applyBindings(viewModel);
        loadState();

    });
</script>
<script src="~/Scripts/Common/datepicker.js"></script>